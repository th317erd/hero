{
  "permissions": {
    "allow": [
      "Bash(node -e:*)",
      "Bash(npm install:*)",
      "Bash(npm test:*)",
      "Bash(sudo nginx:*)",
      "Bash(curl:*)",
      "Bash(cat:*)",
      "Bash(grep:*)",
      "Bash(ls:*)",
      "Bash(xargs:*)",
      "Bash(nginx -T:*)",
      "Bash(lsof:*)",
      "Bash(pgrep:*)",
      "Bash(node --check:*)",
      "Bash(git add:*)",
      "WebSearch",
      "Bash(timeout 5 node:*)",
      "WebFetch(domain:www.npmjs.com)",
      "Bash(npm ls:*)",
      "Bash(node --test:*)",
      "Bash(package.json )",
      "Bash(package-lock.json )",
      "Bash(public/css/*.css)",
      "Bash(public/index.html )",
      "Bash(public/js/*.js)",
      "Bash(public/assets/ )",
      "Bash(public/favicon.ico )",
      "Bash(server/database.mjs )",
      "Bash(server/index.mjs )",
      "Bash(server/routes/*.mjs)",
      "Bash(server/lib/assertions/*.mjs)",
      "Bash(server/lib/pipeline/*.mjs)",
      "Bash(server/lib/processes/*.md)",
      "Bash(server/lib/processes/*.mjs)",
      "Bash(server/lib/websocket.mjs )",
      "Bash(server/lib/abilities/ )",
      "Bash(server/lib/interactions/ )",
      "Bash(server/lib/markup/ )",
      "Bash(server/lib/operations/ )",
      "Bash(docs/ )",
      "Bash(spec/)",
      "Bash(git commit -m \"$(cat <<''EOF''\nAdd Interactions System, modularize frontend, apply code style fixes\n\nMajor changes:\n\nInteractions System:\n- Add InteractionBus for pub/sub message routing between agent, system, and user\n- Add InteractionFunction base class with permission checking and lifecycle\n- Add function registry for dynamic function registration\n- Implement websearch function with Puppeteer\n- Add interaction detector for parsing agent JSON responses\n- Add comprehensive test suite (60 tests)\n\nAbilities System:\n- Rename \"processes\" to \"abilities\" throughout UI\n- Add abilities loader system (builtin, system, user, plugin, commands)\n- Add ability approval workflow with session-level permissions\n- Add ability question system for agent-to-user queries\n\nFrontend Modularization:\n- Break up app.js (3200+ lines) into smaller modules:\n  - state.js: State object and DOM elements\n  - utils.js: Utility functions\n  - api.js: API functions\n  - routing.js: Route handling\n  - sessions.js: Sessions list management\n  - markup.js: Hero Markup Language rendering\n- Split CSS into component files\n\nCode Style Fixes:\n- Add parentheses to all ternary conditions per quirks\n- Fix arrow function parameter parentheses\n- Convert nested ternaries to if/else blocks\n- Align object properties\n\nDocumentation:\n- Add comprehensive docs/ folder with architecture, API, and feature docs\n- Update STATUS.md with current system state\n\n Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\nEOF\n)\")",
      "Bash(timeout 5 DEBUG=1 node:*)",
      "Bash(DEBUG=1 timeout 5 node:*)",
      "Bash(node get-api-key.mjs:*)",
      "Bash(node /tmp/test-interaction-flow.mjs:*)",
      "Bash(pkill:*)",
      "Bash(npm run stop:*)",
      "Bash(npm run start:bg)",
      "Bash(sqlite3:*)",
      "Bash(DEBUG=1 npm run:*)",
      "Bash(timeout 60 tail:*)",
      "Bash(timeout 45 tail:*)",
      "WebFetch(domain:medium.com)",
      "Bash(npm run start:bg:*)",
      "Bash(git commit -m \"$(cat <<''EOF''\nAdd scroll button, header usage display, usage correction command, and improved compaction\n\nFeatures:\n- Scroll-to-bottom button: Floats at bottom-right when user scrolls up, auto-hides when near bottom\n- Header usage display: Shows global and session token costs in header bar\n- /update_usage command: Allows users to correct token tracking by reporting actual API cost\n- Improved compaction: Enhanced prompt captures comprehensive context and generates TODO lists\n\nNew files:\n- server/routes/usage.mjs - Usage API with correction endpoints\n\nDatabase:\n- Migration 011: usage_corrections table for storing manual adjustments\n\nUI changes:\n- Removed floating cost display (now in header)\n- Added usage display elements to both session and chat headers\n- Added scroll-to-bottom button in chat view\n\nCode changes:\n- app.js: handleUpdateUsageCommand, loadGlobalUsage, updateScrollToBottomButton\n- api.js: fetchUsage, createUsageCorrection functions\n- compaction.mjs: Enhanced buildCompactionPrompt with context summary and TODO list\n- routing.js: Load global usage on authentication\n\n Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\nEOF\n)\")",
      "Bash(git commit -m \"$(cat <<''EOF''\nAdd token charges system with Global/Service/Session spend tracking\n\nMajor changes:\n\nToken Charges System:\n- New token_charges table records every API call with agent_id, session_id, message_id\n- Stores input/output tokens and cost in cents per charge\n- Supports ''usage'' and ''correction'' charge types\n\n3-Line Spend Display:\n- Global Spend: Total cost across ALL agents for the user\n- Service Spend: Cost for all agents sharing the same API key (same service account)\n- Session Spend: Cost for the current session only\n\nDatabase:\n- Migration 012: token_charges table with indexes\n- Migration 013: messages.private column for user-only messages\n\nAPI Endpoints:\n- GET /api/usage - Global spend\n- GET /api/usage/session/:id - Global, Service, and Session spend\n- POST /api/usage/charge - Record a charge\n- POST /api/usage/correction - Add cost correction\n- GET /api/usage/history - Charge history\n\nQuery Logic:\n- Match agents by encrypted api_key for Service Spend calculation\n- Sum charges per session for Session Spend\n\nFiles changed:\n- server/database.mjs - New migrations\n- server/routes/usage.mjs - Complete API rewrite\n- server/routes/messages-stream.mjs - Record charges on API calls\n- public/index.html - 3-line header display\n- public/js/*.js - Updated state and API functions\n- public/css/layout.css - Stacked usage display\n\n Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\nEOF\n)\")",
      "Bash(git commit -m \"$(cat <<''EOF''\nAdd usage tests, unify test runner to Node.js built-in\n\nTest Suite:\n- Add spec/routes/usage-spec.mjs with 30 tests for token charges system\n- Tests cover cost calculation, global/service/session spend, corrections, history\n\nTest Runner Unification:\n- Convert all spec files from Jest syntax to Node.js test runner (node:test)\n- Files converted: encryption-spec, config-path-spec, base-agent-spec, hooks-spec, loader-spec\n- All 177 tests now pass with `npm test`\n\nDocumentation:\n- Update STATUS.md with test suite details\n- Update todo.md with completed items\n\n Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\nEOF\n)\")",
      "Bash(npm view:*)",
      "mcp__puppeteer__puppeteer_navigate",
      "Bash(npx puppeteer:*)",
      "mcp__puppeteer__puppeteer_screenshot",
      "mcp__puppeteer__puppeteer_fill",
      "mcp__puppeteer__puppeteer_click",
      "mcp__puppeteer__puppeteer_evaluate",
      "Bash(TOKEN=\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOjIsInVzZXJuYW1lIjoiY2xhdWRlIiwic2VjcmV0Ijp7ImRhdGFLZXkiOiIyOGJkNjdmMzkzYTU4YTUyN2MzM2JjNjgwYzcyNjkxYjFhNTMyZTI2ZmRmZmFjNGVhYjkzNmJlMjcxMzRjYjQyIn0sImlhdCI6MTc3MDQ0MDk1MywiZXhwIjoxNzczMDMyOTUzfQ.HyTrVun5MtEWRITYf4LD0fwQEaERvlCDp3unYOu78PU\")"
    ]
  }
}
