<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hero</title>
  <base href="/hero/">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="stylesheet" href="css/styles.css?v=3">
  <link rel="stylesheet" href="css/buttons.css">
  <link rel="stylesheet" href="css/content.css">
  <link rel="stylesheet" href="css/abilities.css">
  <link rel="stylesheet" href="css/modals.css?v=3">

  <!-- Import map for Mythix UI CDN-style imports -->
  <script type="importmap">
  {
    "imports": {
      "@cdn/mythix-ui-core@1": "/mythix-ui/mythix-ui-core/dist/index.js?v=3",
      "@cdn/mythix-ui-modal@1": "/mythix-ui/mythix-ui-modal/dist/mythix-ui-modal.js?v=3",
      "@cdn/mythix-ui-for-each@1": "/mythix-ui/mythix-ui-for-each/dist/mythix-ui-for-each.js",
      "@hero/api": "/hero/js/api.js",
      "@hero/base": "/hero/js/components/hero-base.js",
      "@hero/state": "/hero/js/state.js",
      "@hero/utils": "/hero/js/utils.js"
    }
  }
  </script>

  <!-- Mythix UI URL Resolver for component lazy loading -->
  <script>
    const mythixUI = (globalThis.mythixUI = (globalThis.mythixUI || {}));

    // Disable strict mode to allow complex template expressions (requires unsafe-eval CSP)
    mythixUI.strictMode = false;

    // Resolver for <mythix-require> component loading
    mythixUI.urlResolver = ({ src, path, fileName }) => {
      // Handle @cdn/hero-* pattern for hero components
      let heroMatch = src.match(/^@cdn\/(hero-[\w-]+)(@[\d.]+)?$/);
      if (heroMatch) {
        return `/hero/js/components/${heroMatch[1]}/${heroMatch[1]}.html`;
      }

      // Handle @cdn/hml-* pattern for HML components
      let hmlMatch = src.match(/^@cdn\/(hml-[\w-]+)(@[\d.]+)?$/);
      if (hmlMatch) {
        return `/hero/js/components/${hmlMatch[1]}/${hmlMatch[1]}.html`;
      }

      // Handle @cdn/session-frames-provider pattern
      if (src.match(/^@cdn\/session-frames-provider(@[\d.]+)?$/)) {
        return `/hero/js/components/session-frames-provider/session-frames-provider.html`;
      }

      // Handle @cdn/mythix-* pattern for mythix-ui components
      let mythixMatch = src.match(/^@cdn\/(mythix-[\w-]+)(@[\d.]+)?$/);
      if (mythixMatch) {
        return `/mythix-ui/${mythixMatch[1]}/dist/${mythixMatch[1]}.html`;
      }

      return src;
    };
  </script>

  <!-- Load mythix-ui-core to register MythixUIRequire custom element -->
  <!-- This MUST happen before <mythix-require> elements in body are parsed -->
  <script type="module">
    import '@cdn/mythix-ui-core@1';
  </script>
</head>
<body>
  <!-- Shadow DOM components loaded via mythix-require (need HTML templates) -->
  <mythix-require src="@cdn/mythix-ui-for-each@1"></mythix-require>
  <mythix-require src="@cdn/mythix-ui-modal@1"></mythix-require>
  <mythix-require src="@cdn/hero-modal@1" cache="no-store"></mythix-require>
  <mythix-require src="@cdn/hero-header@1"></mythix-require>
  <mythix-require src="@cdn/hero-status-bar@1" cache="no-store"></mythix-require>
  <mythix-require src="@cdn/hero-main-controls@1"></mythix-require>
  <mythix-require src="@cdn/hero-sessions-list@1"></mythix-require>
  <mythix-require src="@cdn/hero-chat@1"></mythix-require>
  <mythix-require src="@cdn/hero-input@1"></mythix-require>
  <mythix-require src="@cdn/hml-prompt@1"></mythix-require>
  <mythix-require src="@cdn/session-frames-provider@1"></mythix-require>
  <mythix-require src="@cdn/hero-login@1"></mythix-require>
  <mythix-require src="@cdn/hero-settings@1"></mythix-require>
  <mythix-require src="@cdn/hero-participant-list@1"></mythix-require>

  <hero-app id="app">
    <!-- WebSocket handler -->
    <hero-websocket></hero-websocket>

    <!-- Status bar (bottom) - starts hidden, revealed by JS when authenticated -->
    <hero-status-bar id="status-bar" class="hidden"></hero-status-bar>

    <!-- Modal components -->
    <hero-modal-create-session id="new-session-component" style="display: none;"></hero-modal-create-session>
    <hero-modal-create-agent id="new-agent-component" style="display: none;"></hero-modal-create-agent>
    <hero-modal-configure-ability id="ability-component" style="display: none;"></hero-modal-configure-ability>
    <hero-modal-abilities id="abilities-component" style="display: none;"></hero-modal-abilities>
    <hero-modal-agents id="agents-component" style="display: none;"></hero-modal-agents>
    <hero-modal-agent-settings id="agent-config-component" style="display: none;"></hero-modal-agent-settings>

    <!-- Login View -->
    <div id="login-view" class="view" data-view="login" style="display: none;">
      <hero-login id="login-component"></hero-login>
    </div>

    <!-- Sessions List View -->
    <div id="sessions-view" class="view" data-view="sessions" style="display: none;">
      <hero-header id="sessions-header"></hero-header>
      <main class="sessions-main">
        <hero-sessions-list id="sessions-list"></hero-sessions-list>
      </main>
    </div>

    <!-- Chat View -->
    <div id="chat-view" class="view" data-view="chat" style="display: none;">
      <hero-header id="chat-header"></hero-header>
      <div class="chat-layout">
        <session-frames-provider id="session-frames">
          <main class="chat-main">
            <hero-chat id="chat"></hero-chat>
          </main>
          <footer class="chat-footer">
            <hero-input id="chat-input"></hero-input>
          </footer>
        </session-frames-provider>
        <aside id="participant-sidebar" class="participant-sidebar">
          <hero-participant-list id="participant-list"></hero-participant-list>
        </aside>
      </div>
    </div>

    <!-- Settings View -->
    <div id="settings-view" class="view" data-view="settings" style="display: none;">
      <hero-header id="settings-header"></hero-header>
      <hero-settings id="settings"></hero-settings>
    </div>

    <!-- Running Operations Panel -->
    <div id="operations-panel" class="operations-panel" style="display: none;">
      <div class="operations-header">
        <span>Running Operations</span>
        <button type="button" id="toggle-operations" class="button button-icon">&#8722;</button>
      </div>
      <div id="operations-list" class="operations-list"></div>
    </div>
  </hero-app>

  <!-- Component imports (ES modules) -->
  <script type="module">
    // Hero components (includes Mythix-UI dependency)
    import './js/components/index.js?v=5';
  </script>

  <script src="js/stores/session-store.js?v=1"></script>
  <script src="js/markup.js?v=3"></script>
  <script src="js/state.js?v=5"></script>
  <script src="js/utils.js?v=2"></script>
  <script src="js/debug.js?v=2"></script>
  <script src="js/api.js?v=8"></script>
  <script src="js/routing.js?v=3"></script>
  <script src="js/sessions.js?v=2"></script>
  <script src="js/approvals.js?v=1"></script>
  <script src="js/streaming.js?v=1"></script>
  <script src="js/commands.js?v=1"></script>
  <script src="js/app.js?v=10"></script>
</body>
</html>
