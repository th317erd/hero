# Hero Known Issues - Compressed YAML
# sev=severity, f=files, d=description, root=root cause

bugs:
  duplicate_update_prompt:
    d: When user answers prompt, AI also sends update_prompt (duplicate)
    root: prompt_response_handler matchCondition timing vs getUnansweredPrompts
    sev: medium
    symptom: "Prompt not found" errors
    f: [builtin.mjs, conditional.mjs, messages-stream.mjs]

  system_interaction_results_in_chat:
    d: update_prompt results displayed as streaming elements
    root: onInteractionResult doesn't guard for silent interactions
    sev: medium
    symptom: ugly JSON in chat
    f: [streaming.js]

  prompt_state_revert:
    d: State re-render from state.messages can revert answered prompt state
    root: ID mismatch (string vs number) in updatePromptInState
    sev: medium
    symptom: prompt may not turn green immediately, resolves on reload
    f: [app.js, hml-prompt.js, streaming.js]

code_smells:
  dual_state_management:
    d: "State in: state.messages, GlobalState.heroFrames, session-frames-provider, DB frames"
    impact: changes don't propagate between them
    fix: make frames the ONLY state, remove state.messages
    sev: high
    secondary_bugs: many

  multiple_render_triggers:
    d: "renderMessages(), renderDebounced(), updateStreamingContent(), WS frame_update"
    symptom: render loop detection (_renderCount > 10) is itself a symptom
    fix: single render loop with dirty checking, RAF batching
    sev: high
    impact: performance, race conditions

  event_handler_cascade_guards:
    d: "_handlingEnter, _hmlHandled scattered everywhere"
    root: events bubble through Shadow DOM, multiple handlers catch
    fix: single event handler, event delegation
    sev: medium
    impact: fragile, hard to reason about

  mixed_content_formats:
    d: content can be string OR Claude API array format
    root: constant format checking repeated in many files
    fix: normalizeContent() utility at frame creation time
    sev: medium
    impact: code duplication, bugs

tech_debt:
  legacy_code_paths:
    - Old operations system still partially referenced
    - Some assertions-era code paths remain
    - state.messages used alongside frames

infra:
  websocket_reconnect_spam:
    d: Users 1 and 8 rapidly reconnecting in server logs
    concern: may indicate connection management issue
